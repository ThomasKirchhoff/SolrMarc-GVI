#summary Getting started with the binary distribution of SolrMarc.

=== About This Document ===

This getting started guide describes the !SolrMarc binary distribution for Blacklight and !VuFind, defines its software dependencies, guides the user through using the !SolrMarc binary to index a file of MARC records.

<br/>
=== About !SolrMarc ===

!SolrMarc is a utility that reads in MARC records from a file, extracts information from various fields as specified in an indexing configuration script, and adds that information to a specified SOLR index.

!SolrMarc provides a rich set of techniques for mapping the tags, fields, and subfields contained in the MARC record to the fields you wish to include in your SOLR index record, but it also allows the creation of custom index functions if you cannot achieve what you require using the predefined mapping techniques.

Currently, !SolrMarc is configured to work with:
  * [http://blacklightopac.org/ Blacklight]
  * [VufindHowTo Vufind]


NOTE: If you anticipate a need for custom indexing functions, you will need to download the !SolrMarc source code and build the package using the instructions from the [GettingStarted] document on this wiki.

<br />
=== Software Dependencies ===

!SolrMarc requires the java runtime environment (JRE) version 1.5 or newer (or version 1.5 or newer of the java development kit (JDK).)

To check the version of your installed java at the command prompt type:

   _java -version_

To download the proper version of the java, go to http://java.sun.com/javase/downloads/index.jsp

<br/>
=== Downloading the !SolrMarc Binary Distribution ===

To get the binary distribution, download {{{Binary_Generic_VuFind_SolrMarc_Unix.tar.gz}}}, {{{Binary_Generic_VuFind_SolrMarc_PC.zip}}}, {{{Binary_Vanilla_Blacklight_SolrMarc_Unix.tar.gz}}} or {{{Binary_Vanilla_Blacklight_SolrMarc_PC.zip}}} from [http://code.google.com/p/solrmarc/downloads/list the project's downloads page]. The binary distribution consists of a single large jar file containing all of the code, libraries and data files to configure and run !SolrMarc.

The only difference between the two binary distributions is that the Unix version contains a number of bash shell scripts for running the !SolrMarc indexer or for running the the other utility programs associated with running !SolrMarc, whereas the PC version of the binary distribution contain batch files to perform the same tasks. 

<br />
=== Unpacking the Binary Distribution ===
Create a directory and copy the !SolrMarc distribution you just made into it. You can do this anywhere, but for this example let's create a directory called {{{indexer}}} at the top level of either your blacklight or your vufind directory. Now unzip the distribution file. On unix, the command is _tar zxvf filename_. On windows, you can run winzip or some similar program.

<br />
=== Configuring !SolrMarc ===
!SolrMarc uses a series of Java properties files for its configuration, and these are stored inside the single large jar file that is included in the binary distribution. Some of the values in these properties files need to be set before you will be able to run !SolrMarc to produce an index for your VuFind or Blacklight installation.
 
If you unpack the binary distribution into a directory named {{{indexer}}} inside your chosen demo distribution, all you need to do is run two shell scripts to configure the !SolrMarc indexer.

First run:
 
   {{{indexer/setsolrwar ./jetty/webapps/solr.war}}}

then run:
 
   {{{indexer/setsolrhome ./jetty/solr}}} 

<br />
=== Running !SolrMarc ===
You will then be ready index MARC records into the solr index that will be used by your implementation of Blacklight or !VuFind via the following command:
 
   {{{indexer/indexfile /path/to/marcrecords.mrc}}}

The command will display informational messages and warnings while it is running, processing MARC records. 

To index the sample record included in the demo distribution in the data directory use the following commands: 

   {{{indexer/indexfile ./data/test_data.utf8.mrc}}}<br />
   {{{indexer/indexfile ./data/lc_records.utf8.mrc}}} 

or to index both at one time: 

   {{{cat ./data/*.mrc | indexer/indexfile }}}


<br />
=== Changing your indexing options ===
Chances are you aren't going to want to index your own data exactly the way we have things set up for the demo application. Here's how to start making changes to the index mappings.

Go to the {{{indexer}}} directory where you unpacked !SolrMarc. The .jar file you see there contains several configuration files that you can extract, edit, and replace. The basic pattern looks like this:
 
   # extract the file: {{{jar xvf Vanilla_Blacklight_SolrMarc.jar demo_index.properties}}} 
   # edit the file you just extracted (demo_index.properties in this case) 
   # replace the file: {{{jar uvf Vanilla_Blacklight_SolrMarc.jar demo_index.properties}}} 

<br />
==== demo_config.properties ====
The main configuration file is named demo_config.properties. A Blacklight example of it is shown below.
{{{
# Path to your solr instance
solr.path = /usr/local/blacklight/solr
solr.indexer = org.solrmarc.index.SolrIndexer
solr.indexer.properties = demo_index.properties
#optional URL of running solr search engine to cause updates to be recognized.
solr.hosturl = http://localhost:8983/solr/update
marc.to_utf_8 = true
marc.permissive = true
marc.default_encoding = MARC8
marc.include_errors = false
}}}
Depending on your local MARC records, you might want to change the default encoding, or other values. If you need lots of customization it's probably better to build a custom distribution from source. For instructions on building a custom distribution, please see the [GettingStarted] doc on this wiki.

<br />
==== demo_index.properties ====
The configuration that handles all of the mappings from MARC to Solr is {{{demo_index.properties}}}. You will probably want to use it to get started, and then as you shape what your institution's MARC mappings look like, it will be worthwhile to build your own distribution from source. The {{{demo_index.properties}}} that is configured to work with the Blacklight demo application looks like this:
{{{
id = 001, first
title_t = custom, removeTrailingPunct(245a)
sub_title_t = custom, removeTrailingPunct(245c)
alt_titles_t = custom, removeTrailingPunct(240b:700t:710t:711t:440a:490a:505a:830a)
title_added_entry_t = custom, removeTrailingPunct(700t)
author_t = custom, removeTrailingPunct(110a:111a:130a:700a:710a:711a)
published_t = custom, removeTrailingPunct(260a)
isbn_t = 020a, (pattern_map.isbn_clean)
material_type_t = custom, removeTrailingPunct(300a)
subject_t = custom, removeTrailingPunct(600a:610a:611a:630a:650a:651a:655a:690a)
subject_era_facet = custom, removeTrailingPunct(650d:650y:651y:655y)
geographic_subject_facet = custom, removeTrailingPunct(650z:651a:650c:651x:651z:655:z)
language_facet = 008[35-37]:041a:041d, language_map.properties
marc_display = FullRecordAsXML
}}}
See [ConfiguringSolrMarc] for more information about configuration options for these files. 

<br />