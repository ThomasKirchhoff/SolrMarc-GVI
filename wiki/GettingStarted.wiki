#summary These pages will guide you through installing and building solrmarc
#labels Phase-Implementation
#sidebar TableOfContents

=== About This Guide ===

This getting started guide describes SolrMarc, defines its software dependencies, steps the user through configuring and building the importer program, and gives basic information about some helpful scripts that are included in the SolrMarc program’s tools.


=== What Is SolrMarc? ===

SolrMarc is a utility that reads in MARC records from a file, extracts information from various fields as specified in an indexing configuration script, and adds that information to a specified SOLR index.

SolrMarc provides a rich set of techniques for mapping the tags, fields, and subfields contained in the MARC record to the fields you wish to include in your SOLR index record, but it also allows the creation of custom index functions if you cannot achieve what you require using the predefined mapping techniques.

Currently, solrmarc is configured to work with:
  * Blacklight
  * [VufindHowTo Vufind]

=== Software Dependencies ===

SolrMarc requires the java development kit (JDK) version 1.5 or newer and ant version 1.7 or newer.

==== Java ====

To check the version of the java development kit (JDK), at the command prompt type

   _javac -version_

To download the proper version of the java development kit, go to http://java.sun.com/javase/downloads/index.jsp

==== Ant ====

To check the ant version, at the command prompt type

   _ant -version_

To download the proper version of ant, go to http://ant.apache.org/

==== Solr ====

While SolrMarc can build a Solr index on its own, you probably already have Solr installed on your system. If not, you will want to install Solr. SolrMarc 2.0 has been tested with 1.2, 1.3, and several versions of 1.4 (still in beta).

To download Solr, go to http://lucene.apache.org/solr/

==== SolrMarc 2.0 ====

Download the software via a subversion checkout:

{{{ svn checkout http://solrmarc.googlecode.com/svn/trunk  solrmarc }}}

=== Configuring the Importer Program ===

At the command prompt, run 

   _ant init_

By default, ant builds the whole program and will query user for correct settings.

==== Questions: ====

*_1.Enter the name of a directory to contain all site specific modifications, including the configuration and index files_*

The program builder will query which of the three example directories you wish you use as a template for your SolrMarc installation, for example, ../vanillaBlacklightDemo/.

Once you've chosen, the builder creates the directory and subdirectories based on this template to prepare the structure to be filled in with rest of setup information.

*_2.Enter the name of the Jar file containing custom indexing functions._*

If you require custom indexing functions, provide the jar file name that contains that code.

   ex. custom.jar

Enter _"none"_ if you expect not to have any custom indexing functions.

*_3.Enter prefix of the properties files for config and index files for custom modifications._*

Enter the name to be used to identify this instance of SolrMarc.

   ex. my_config.properties; my_index.properties

*_4.Enter name of the final resulting Jar file that will contain all the code, libraries, and properties for running SolrMarc._*

   Default suggestion customprefix_solrmarc.jar

*_5.Enter java heap size memory argument to put in generated scripts for site-specific SolrMARC indexer._*

   Default value=256MB

Note: While 256MB is sufficient to load the demo, a real-world indexing job requires a much larger java heap size. The developer uses 1024MB on his desktop and at least 2048MB on the server where the indexing job will include millions of records.

Custom settings are now written out to a file so that they are preserved for future updates.

*_6.Enter the version of SOLR you will be running in your local environment._*

(SolrMarc has been tested with 1.2, 1.3, and several versions of 1.4(still in beta))

Best practice is to specify _“war”_ as the answer to this question, and then give the full path to the current solr.war file which will be used by the jetty or tomcat web server for searching the solr index. This will ensure that you won’t create an index that is out of sync with what the webserver code expects.

==== Configuration files: ====

Fill in the xxxx_config and xxxx_index files in the site specific directory that you've just created using the template files that were created in the build.

*xxxx_config.properties:* controls overall operation of the program

*xxxx_index.properties:* where the mapping from MARC tags to SOLR fields is specified

Because it is possible to have multiple instances of SolrMarc running on a server, the prefix helps the system administrator know to which instance the configuration files refer.

==== Configuration file: ====

{{{# Properties for the Java import program
# $Id: importSamples.properties 17 2008-06-20 14:40:13Z wayne.graham $

# Path to your solr instance
solr.path = /usr/local/projects/bl-demo/bl-demo/jetty/solr
solr.indexer = org.solrmarc.index.SolrIndexer
solr.indexer.properties = demo_index.properties

#optional URL of running solr search engine to cause updates to be recognized.
solr.hosturl = http://localhost:8983/solr/update

# Path to your marc file
marc.to_utf_8 = true
marc.permissive = true
marc.default_encoding = MARC8
marc.include_errors = true }}}

==== Index file: ====

[coming soon]

=== Building the Importer Program ===

Once you have finished editing the xxxx_config.properties file and the xxxx_index.properties file located in your site specific directory, 

   1.Change back to the top level directory where you first ran _ant init_,  and 

   2.run _ant build_   

This action compiles all of the standard source code for the importer, compiles any custom source code that you have created in your site specific directory, and creates a large jar file containing all of the compiled code, any jar files needed by the code, and the properties files that control how the program runs, including your xxxx_ config.properties, and your  xxxx_index.properties.  

A directory called {{{.dist/}}} is created by the build process. The builder places the jar file that contains all the code and libraries for SolrMarc to run in this directory.   Additionally, several shell scripts/batch files that make using the indexing program and its associated utilities much easier to run are placed in this dist directory.

Assuming no errors are encountered in the build process, the build is now complete.

For documentation on using SolrMarc to index your marc records, please see the Using SolrMarc document. [coming soon]


=== Batch Files/Shell Scripts ===

*indexfile:* indexes file of MARC records, adding all data from those records to the Solr index.

*setsolrhome:* extracts the settings for where the Solr server is running and where the Solr files are to be found from the config file and 

   if issued without parameters: displays them
   if issued with parameters: sets them

*showconfig:* finds the config file it will be using and displays it onscreen.

*printrecord:* looks at the MARC records and transforms them into human-readable format. The user specifies the name of the MARC file, and the script prints all records to the screen. This script is helpful in troubleshooting indexing operations, and for selecting tags/fields/subfields for mapping.

*indextest:* processes the file of MARC records and displays to the screen what it will be sending  to SOLR for the records in the file.

*filterrecords:* could be called “marcgrep,” selects only those records that contain certain fields or certain values in certain fields. The user specifies the pattern they are seeking in the file on the command line.

*getrecord:* extracts a record from a MARC file, matching a record id specified by user.

*updatesolrserver:* sends a commit message to the URL where solr is running to update a running instance with new index data.

*optimizesolr:* optimizes the solr index to be a single segment.